# 05. Troubleshooting Log (트러블슈팅 기록)

프로젝트 구축 과정에서 겪은 주요 기술적 난관과 해결 과정을 기록합니다.

## 1. K8s 서비스 표준 포트(80) 노출 문제
### 상황
서비스 진입점을 `http://localhost/` (표준 80포트)로 설정하고자 했으나, Kubernetes의 `NodePort` 서비스는 기본적으로 `30000-32767` 범위의 포트만 할당 가능했습니다. 이로 인해 프론트엔드 포트를 80으로 설정하여 배포했음에도 외부에서 접근이 불가능한 현상이 발생했습니다.

### 해결 과정
1. **문제 인식:** K8s 서비스 타입 중 NodePort의 물리적 한계를 파악함.
2. **대안 검토:** LoadBalancer 타입(클라우드 미사용 시 제한적)과 Ingress 컨트롤러 검토.
3. **Ingress 도입:** Docker Desktop에 **NGINX Ingress Controller**를 설치하고 `ingress.yaml`을 구성함.
4. **포트 포워딩:** 인그레스 컨트롤러가 호스트의 80포트를 점유하고, 내부적으로 서비스 포트(80/8080)로 트래픽을 라우팅하도록 설정함.

### 결과
외부 사용자는 포트 번호 없이 `localhost`만으로도 서비스에 접근할 수 있게 되었으며, 내부 마이크로서비스 간의 포트 체계도 깔끔하게 정리됨.

---

## 2. API 경로 중복 및 리팩토링 (`/api/api/` 이슈)
### 상황
프론트엔드에서 API 요청 시 URL에 `/api/api/`가 중복으로 붙어 404/401 에러가 발생하는 현상이 발생했습니다.

### 원인 분석
- **Axios BaseURL:** `/api`로 설정됨.
- **API 모듈 정의:** 각 함수(예: `checkNickname`) 내부에 다시 `/api`가 하드코딩되어 있었음.

### 해결 방법
유지보수 편의성을 위해 **코드 내부의 `/api`를 전면 제거**하는 리팩토링을 단행했습니다. 이제 모든 경로는 자원(Resource) 위주로 기술되며, 공통 경로인 `/api`는 환경 변수를 통해 `axios.js`의 `baseURL`에서만 관리됩니다.

---

## 3. SSE (Server-Sent Events) 연결 및 JWT 인증 이슈
### 상황
브라우저의 `EventSource` API는 표준상 HTTP 요청 헤더에 `Authorization`을 포함하는 기능을 제공하지 않습니다. 이로 인해 백엔드 전역 보안 필터에서 JWT 토큰을 확인하지 못해 SSE 연결이 즉시 차단(401 Unauthorized)되는 현상이 발생했습니다.

### 해결 과정
1. **문제 인식:** `EventSource`의 제약 사항과 스프링 시큐리티 필터 체인의 동작 방식을 분석함.
2. **서버 로직 수정:** `JwtAuthenticationFilter`에서 헤더뿐만 아니라 요청 URL의 쿼리 스트링(`?token=...`)에서도 토큰을 추출할 수 있도록 로직을 확장함.

### 결과
별도의 외부 라이브러리 없이도 표준 SSE 통신을 보안 요건에 맞게 구축하여 실시간 알림 기능을 성공적으로 연동함.

---

## 4. 커밋 이력 기반 주요 해결 사항
최근 커밋 이력을 바탕으로 한 추가 트러블슈팅 내역입니다.

| 커밋 태그 | 해결 내용 | 비고 |
| :--- | :--- | :--- |
| `refactor` | 프론트엔드 API 경로 `/api` 접두사 제거 및 설정 환경변수화 | 유지보수성 향상 |
| `fix` | 서비스 및 인그레스 포트 80/8080 동기화 | 로컬 접근 문제 해결 |
| `fix` | SSE 연결 시 JWT 인증 필터 우회 및 쿼리 파라미터 처리 | 실시간 알림 연동 성공 |
| `fix` | Nginx `client_max_body_size` 50M 확장 | 고해상도 이미지 업로드 해결 |
| `feat` | AWS S3 Presigned URL 기능 구현 | 보안 강화 및 이미지 조회 최적화 |
| `fix` | JWT 시크릿 키 최소 길이(32자) 미달 에러 | 보안 규격 준수 |
